@model OneHourSport.Web.Models.Field.FieldDetailsViewModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="container">
    <div class="row text-center">
        <br />
        <div class="myBox container">
            <div class="row text-center profileBackground">
                Sport Field - @Model.Name
            </div>
            @Html.Partial("_ListPicturesPartial", Model.Pictures)
            <br />
            <div class="row">
                <hr />
                <div class="col-md-4 text-center col-md-offset-4 profileBackground">
                    Information
                </div>
            </div>
            <div class="row">
                <hr />
                <div class="col-md-6">
                    <div class="row">
                        @Html.Label("Name:")
                        @Html.DisplayFor(x => x.Name)
                    </div>
                    <div class="row">
                        @Html.Label("Category:")
                        @Html.DisplayFor(x => x.Category)
                    </div>
                    <div class="row">
                        @Html.Label("A part of:")
                        @Html.ActionLink(Model.SportComplex.Name, "ComplexDetails", "Complex", new { id = Model.SportComplex.Id }, null)
                    </div>
                    <div class="row">
                        @Html.Label("Price per hour:")
                        @Html.DisplayFor(x => x.PricePerHour) lv
                    </div>
                </div>
                <div class="col-md-6 text-center">
                    <div class="row">
                        <div class="col-md-4 text-center col-md-offset-4 profileBackground">
                            Description
                        </div>
                    </div>
                    <p>
                        <span style="width: 10em; word-wrap: break-word;">
                            @Html.DisplayTextFor(m => m.Description)
                        </span>
                    </p>
                </div>
            </div>
            <div class="row text-center menuHoursBackground">
                @Ajax.ActionLink("Schedule", "GetShedule", "Shedule", new { date = DateTime.Now.Date, fieldId = Model.Id },
                new AjaxOptions
                {
                    InsertionMode = InsertionMode.Replace,
                    UpdateTargetId = "sheduleContainer",
                    HttpMethod = "GET",
                    LoadingElementId = "loadingShedule"
                }, new { id = "sheduleLink" })
               
               <h4 class="pull-right" style="color: white;display: inline-block; margin-right: 10px;"><a id="hideContent" class="btn-link">X</a></h4>
            
            </div>
            <div id="loadingShedule" hidden="hidden">
                <h1>Loading...</h1>
            </div>
            <div class="shedule" id="sheduleContainer">

            </div>
            <div>
                @Html.Partial("_ListCommentsPartial", Model.Comments);
            </div>
            <div class="row col-md-10 col-md-offset-1">
                @using (Html.BeginForm("Create", "Comment", new { }, FormMethod.Post, new { @class = "", role = "form" }))
                {
                    <div class="row form-group">
                        @Html.AntiForgeryToken()

                        <div class="col-md-offset-2 col-md-4">
                            @Html.TextArea("text", new { @class = "form-control", placeholder = "Text", minlength = 5, required = "required" })
                            @Html.Hidden("fieldId", Model.Id)
                        </div>
                        <div class="col-md-offset-2 col-md-4">
                            <input type="submit" class="btn btn-default btn-lg" value="Create Comment" />
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>
<script type="text/javascript">
        $(function () {
            $(document).on("click", "#sheduleLink", function () {
                $("#sheduleContainer").show();
            })
            $(document).on("click", "#hideContent", function () {
                $("#sheduleContainer").hide();
            })

            var getShedule = function (data) {

                $.ajax({
                    url: '@Url.Content("~/Shedule/GetShedule")',
                    data: data,
                    contentType: "application/json",
                    success: function (data) {
                        $('#sheduleContainer').html(data);
                        console.log("asdasdas");
                      
                    }
                });
            };
            // AntiForgeryToken
            $(document).on("change", "#datePicker", function () {
                var data = {
                    date: $(this).val(),
                    fieldId: Number.parseInt($("#fieldId").val())
                }

                getShedule(data);
            })

           
            var createOccupiedHour = function (data) {

                $.ajax({
                    type: "POST",
                    url: '@Url.Content("~/OccupiedHour/CreateOccupiedHour")',
                    data: JSON.stringify(data),
                    contentType: "application/json",
                    success: function (data) {
                        console.log("SUccess");
                        $("#datePicker").trigger("change");
                    }
                });
            };

            document.saveHour = function (data) {

                createOccupiedHour(data);
            }
        });
</script>
}